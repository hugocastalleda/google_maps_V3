<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Reverse geocoding</title>

    <style type="text/css">
      #map {
        width: 700px;
        height: 400px;
      }
    </style>

    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>

    <script type="text/javascript">
      /**
       * Called on the intiial page load.
       */
     
	  var map;
      var marker = new google.maps.Marker();
      var infoWindow = new google.maps.InfoWindow();
      function init() {
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 14,
          center: new google.maps.LatLng(10.98526, -74.80254),
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        google.maps.event.addListener(map, 'click', findAddress);
  
      }

      function findAddress(event) {
        var geocoder = new google.maps.Geocoder();
        geocoder.geocode({latLng: event.latLng}, function(results, status) {
          if (status == google.maps.GeocoderStatus.OK) {
		  
            if (results[0]) {
			  var html ="<table>" +
			     "<tr><td>Pais:</td> <td><input type='text' "+"value='"+results.slice(-1)[0].address_components.slice(-1)[0].long_name+"'"+"name='pais' id='pais'/> </td> </tr>" +
                 "<tr><td>Departamento:</td> <td><input type='text' "+"value='"+results.slice(-2)[0].address_components.slice(-2)[0].long_name+"'"+"name='departamento' id='departamento'/> </td> </tr>" +
                 "<tr><td>Municipio:</td> <td><input type='text' "+"value='"+results.slice(-3)[0].address_components.slice(-3)[0].long_name+"'"+"name='municipio' id='municipio'/> </td> </tr>" +
				 "<tr><td>Barrio:</td> <td><input type='text' "+"value='"+results.slice(-4)[0].address_components.slice(-4)[0].long_name+"'"+"name='barrio' id='barrio'/> </td> </tr>" +
				 "<tr><td>Direccion:</td> <td><input type='text' "+"value='"+results[0].formatted_address+"'"+" name='direccion' id='direccion'/></td> </tr>" +
                 "<tr><td>Type:</td> <td><select id='type'>" +
                 "<option value='bar' SELECTED>bar</option>" +
                 "<option value='restaurant'>restaurant</option>" +
                 "</select> </td></tr>" +
                 "<tr><td></td><td><input type='button' value='Save & Close' onclick='saveData()'/></td></tr>";;
             marker.setPosition(event.latLng);
             marker.setMap(map);
             infoWindow.setPosition(event.latLng);
             infoWindow.setContent(html);
             infoWindow.open(map);
            }
          }
        });
      }
	  /* funciones para guardar */
	   function saveData() {
      var pais = escape(document.getElementById("pais").value);
      var departamento = escape(document.getElementById("departamento").value);
	  var municipio = escape(document.getElementById("municipio").value);
	  var barrio = escape(document.getElementById("barrio").value);
	  var direccion = escape(document.getElementById("direccion").value);
      var type = document.getElementById("type").value;
      var latlng = marker.getPosition();
      var url = "phpsqlinfo_addrow.php?pais=" + pais + "&departamento=" + departamento +
	            "&municipio=" + municipio +"&barrio=" + barrio +"&direccion=" + direccion +
                "&type=" + type + "&lat=" + latlng.lat() + "&lng=" + latlng.lng();
      downloadUrl(url, function(data, responseCode) {
        if (responseCode == 200 && data.length <= 1) {
		  //removeMarker(marker:google.maps.Marker)
          marker.setMap(null);
		  infoWindow.close();
          document.getElementById("message").innerHTML = "Location added.";
        }
      });
    }

    function downloadUrl(url, callback) {
      var request = window.ActiveXObject ?
          new ActiveXObject('Microsoft.XMLHTTP') :
          new XMLHttpRequest;

      request.onreadystatechange = function() {
        if (request.readyState == 4) {
          request.onreadystatechange = doNothing;
          callback(request.responseText, request.status);
        }
      };

      request.open('GET', url, true);
      request.send(null);
    }

    function doNothing() {}
	  /* funciones para guardar */
      // Register an event listener to fire once when the page finishes loading.
      google.maps.event.addDomListener(window, 'load', init);
    </script>
  </head>
  <body>
    <div id="map"></div>
	<div id="message"></div>
  </body>
</html>
